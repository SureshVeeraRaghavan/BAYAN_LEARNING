<div class="w-full p-4">
  <!-- Page Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <!-- <h1>{{getToken()}}</h1> -->
      <h1 class="text-3xl font-bold text-[20px]">Courses</h1>
      <p class="text-gray-800 text-[15px]">Create and manage courses</p>
    </div>

    <button class="bg-black text-white px-4 py-2 rounded-md cursor-pointer" (click)="openModal()">
      + Add Course
    </button>
  </div>

  <!-- MAIN CONTENT WRAPPER -->
  <div class="max-w-5xl mx-auto">
    <!-- Tabs -->
    <div class="flex justify-center mt-">
      <button
        class="py-2 w-50 rounded text-[14px]"
        [ngClass]="
          activeCourseTab === 'Course 1' ? 'bg-black text-white' : 'bg-gray-200 text-black'
        "
        (click)="activeCourseTab = 'Course 1'"
      >
        Browse Courses
      </button>

      <button
        class="py-2 w-50 rounded text-[14px]"
        [ngClass]="
          activeCourseTab === 'Course 2' ? 'bg-black text-white' : 'bg-gray-200 text-black'
        "
        (click)="activeCourseTab = 'Course 2'"
      >
        My Courses
      </button>

      <button
        class="py-2 w-50 rounded text-[14px]"
        [ngClass]="
          activeCourseTab === 'Course 3' ? 'bg-black text-white' : 'bg-gray-200 text-black'
        "
        (click)="activeCourseTab = 'Course 3'"
      >
        Pending Review
      </button>
    </div>

    <!-- Tab Content -->
    <div class="p-4">
      <!-- courses -->

      <div *ngIf="activeCourseTab === 'Course 1'" class="cards">
        <div
          class="w-full bordersha shadow-md flex flex-col items-center p-5 gap-5 rounded-lg justify-between"
        >
          <div class="text-md font-bold">Find Course</div>

          <div class="flex justify-between w-full gap-5">
            <!-- Search -->
            <input placeholder="Search Courses" class="placeholder-gray-500" name="search" />

            <!-- Category -->
            <select name="category" class="flex-1 rounded-md text-gray-700">
              <option value="" disabled selected>Select Categories</option>

              <option [value]=""></option>
            </select>

            <!-- Level -->
            <select name="level" class="placeholder-gray-500 flex-1 rounded-md text-gray-700">
              <option value="" disabled selected>All Levels</option>

              <option [value]=""></option>
            </select>

            <!-- More Filters -->
            <select
              name="more"
              class="border border-[#ddd] focus:outline-0 p-2 flex-1 rounded-md placeholder:text-gray-400"
            >
              <option value="option1">Option 1</option>
              <option value="option2">Option 2</option>
              <option value="option3">Option 3</option>
            </select>
          </div>
        </div>
        <div class="flex mt-3 flex-col sm:flex-row sm:flex-wrap md:flex-wrap gap-10">
          <!-- <div class="video-container"> -->
          @for (courses of courses; track courses.id) {
          <div class="videp w-67 border border-gray-300 rounded-lg p-4">
            <video
              width="100%"
              height="auto"
              controls
              class="h-50 object-cover rounded-md"
              *ngIf="courses.secureVideo"
            >
              <source
                [src]="courses.secureVideo"
                [type]="courses.metadata?.[0]?.mimeType || 'video/mp4'"
              />
            </video>
            <!-- <div class="flex justify-end mt-1">
               <span class="bg-blue-200 text-[14px] font-medium text-[#171717] rounded p-1 text-sm font-bold">
                       {{ courses.level }}
              </span>
            </div> -->
            <div class="flex justify-between mt-1">
              <span class="category text-[14px] text-black bg-gray-200"> {{ courses.level }}</span>
              <span class="bg-gray-200 text-[14px] rounded p-1"
                ><i class="fa-regular fa-clock"></i> {{ courses.duration }}</span
              >
            </div>
            <div class="flex justify-between m-1">
              <h3 class="text-[14px] font-bold">{{ courses.title }}</h3>
            </div>
            <div class="flex flex-col gap-2">
              <span class="text-gray-800 text-[15px]">{{ courses.description }}</span>
            </div>

            <div class="mt-3">
              <div class="bg-blue-100 p-3 rounded-lg">
                <p class="font-medium">Pre-Requisite Test</p>
                <p class="text-sm">Test required (78% pass rate)</p>
              </div>
            </div>
            <!-- <div *ngFor="let course of courses">
              <p>Owner ID: {{ course.ownerId }}</p>
            </div> -->

            <div *ngIf="role === 'TEACHER'" class="mt-2 flex justify-center">
              <button
                [ngClass]="{
                  'bg-green-200 text-green-700': courses.status === 'active',
                  'bg-gray-400 text-black-700': courses.status === 'inactive',
                  'bg-red-200 text-red-700': courses.status === 'reject'
                }"
                class="p-2.5 w-100 border-0 rounded font-bold text-[14px] cursor-pointer"
              >
                {{
                  courses.status === 'active'
                    ? 'Course Activated'
                    : courses.status === 'inactive'
                    ? 'Waiting for Admin Approval...'
                    : courses.status === 'reject'
                    ? 'Course Rejected'
                    : 'Unknown Status'
                }}
              </button>
            </div>
            <div *ngIf="role === 'ADMIN'" class="mt-2 flex justify-around">
              <p class="hidden">{{ courses.id }}</p>
              <button
                *ngIf="!activatedCourses[courses.id] && !approvedisable[courses.id]"
                (click)="activatecourse(courses.id)"
                class="p-1 border-0 rounded bg-green-500 text-[14px] w-27 fond-bold text-white cursor-pointer"
              >
                Approve
              </button>
              <button
                 *ngIf="!rejectCourses[courses.id] &&!rejectdisable[courses.id]"
                (click)="rejectthe(courses.id)"
                class="p-1 border-0 rounded bg-red-600 text-[14px] fond-bold w-27 text-white cursor-pointer"
              >
                Reject
              </button>
            </div>
            <div
              class="mt-2 flex justify-center"
            >
              <button
                *ngIf="activatedCourses[courses.id]"
                class="p-2.5 border-0 w-100 rounded bg-green-500 text-white cursor-pointer"
              >
                {{ activationMessage }}
              </button>

                <button
                   *ngIf="rejectCourses[courses.id]"
                class="p-2 border-0 w-100 rounded bg-red-600 text-white cursor-pointer"
              >
                {{ RejectedMessage }}
              </button>
            </div>
          </div>
          }
        </div>
      </div>

      <!-- COURSE 2 -->
      <div
        *ngIf="activeCourseTab === 'Course 2'"
        class="space-y-5 flex flex-col sm:flex-row sm:flex-wrap gap-20"
      >
        <div
          *ngFor="let course of userCourses"
          class="w-72 bg-white shadow-md rounded-2xl p-5 space-y-3 border"
        >
          <div class="flex justify-between items-start">
            <h2 class="font-semibold">
              {{ course.name }}
            </h2>
            <span
              class="bg-green-100 text-green-700 text-xs px-3 py-1 rounded-full font-semibold"
              >{{ course.status }}</span
            >
          </div>
          <p class="text-gray-500 text-sm">{{ course.category }}</p>
          <p class="text-gray-600 text-center text-sm">
            {{ course.description }}
          </p>

          <div class="flex justify-between text-sm pt-2">
            <div class="text-center">
              <p class="text-gray-500">Enrollments:</p>
              <p class="font-semibold">234</p>
            </div>
            <div class="text-center">
              <p class="text-gray-500">Rating:</p>
              <p class="font-semibold">4.7</p>
            </div>
          </div>

          <div class="bg-blue-100 text-blue-700 rounded-md p-2 text-sm flex justify-between">
            <span>Pre-Requisite Test</span>
            <span class="font-semibold">78% pass rate</span>
          </div>

          <div class="flex justify-between pt-2">
            <button class="bg-black text-white px-4 py-2 rounded-md text-sm">View</button>
            <button class="border border-gray-300 px-4 py-2 rounded-md text-sm">Edit</button>
            <button class="border border-gray-300 px-3 py-2 rounded-md text-sm">
              <i class="fa-solid fa-gear"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- COURSE 3 -->

      <div *ngIf="activeCourseTab === 'Course 3'" class="space-y-5">
        <div class="w-full border rounded-2xl p-10 text-center bg-white shadow-sm">
          <h2 class="text-xl font-semibold">Pending Review</h2>
          <p class="text-gray-500 text-sm">Courses awaiting curator approval</p>

          <div class="flex justify-center my-10">
            <div
              class="w-14 h-14 flex items-center justify-center rounded-full border-4 border-gray-300"
            >
              <span class="text-4xl text-gray-400">ðŸ•’</span>
            </div>
          </div>

          <h3 class="text-lg font-semibold">No courses pending review</h3>
          <p class="text-gray-500 text-sm">All your courses have been reviewed and published</p>
        </div>
      </div>
    </div>

    <!-- AI Assistant Section -->
    <div class="border p-5 ai-section rounded-xl bg-blue-50 space-y-5 mt-6">
      <div class="flex items-center gap-2 font-semibold text-blue-900">
        <span class="text-lg font-bold">i</span>

        <p>AI Course Assistant</p>
      </div>

      <p class="text-center text-gray-600">Let AI help you create high-quality courses</p>

      <div class="aiassistant">
        <div class="small">
          <!-- <img src="assets/delete.png" alt=""> -->
          <img class="ml-28 bg-blue-600 p-7 text-white rounded-full" src="assets/up-loading.png" />
          <h3 class="font-bold text-[15px] ml-2">Smart Upload</h3>
          <p class="text-gray-600 text-sm m-0">Automatic upload with content type detection</p>
        </div>

        <div class="small">
          <img class="ml-30 bg-green-600 p-7 text-white rounded-full" src="assets/up-loading.png" />
          <h3 class="font-bold ml-3 text-[15px]">AI Validation</h3>
          <p class="text-gray-600 text-sm m-0">Automatic content quality and relevance checking</p>
        </div>

        <div class="small">
          <!-- <img src="../../../assets/up-loading.png" alt="" /> -->
          <img
            class="ml-26 bg-violet-600 p-7 text-white rounded-full"
            src="assets/up-loading.png"
          />
          <h3 class="font-bold ml-3 text-[15px]">Auto Prerequisites</h3>
          <p class="text-gray-600 text-sm m-0">Generate prerequisite tests automatically</p>
        </div>
      </div>

      <button class="bg-blue-600 w-full py-2 text-white rounded-md font-semibold">
        Try AI Assistant
      </button>
    </div>
  </div>

  <!-- MODAL -->

  <div
    *ngIf="showModal"
    class="fixed inset-0 bg-black/30 backdrop-blur-sm flex justify-center items-center z-50"
  >
    <div class="bg-white p-6 rounded-xl shadow-xl w-[680px]">
      <!-- HEADER -->
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-lg font-bold">Create New Course</h2>
          <p class="text-gray-500 text-sm">Create a new course with AI assistance</p>
        </div>
        <button (click)="closeModal()" class="text-gray-500 hover:text-black text-xl">
          <i class="fa-solid fa-xmark text-xl"></i>
        </button>
      </div>

      <!-- TABS -->
      <div class="flex gap-2 overflow-hidden mb-6">
        <button
          class="flex-1 py-2 rounded font-bold"
          [ngClass]="
            activeModalTab === 'metadata' ? 'bg-black text-white' : 'bg-gray-200 text-black'
          "
          (click)="activeModalTab = 'metadata'"
        >
          Metadata
        </button>

        <button
          class="flex-1 py-2 rounded font-bold"
          [ngClass]="
            activeModalTab === 'content' ? 'bg-black text-white' : 'bg-gray-200 text-black'
          "
          (click)="activeModalTab = 'content'"
        >
          Content
        </button>

        <button
          class="flex-1 py-2 rounded font-bold"
          [ngClass]="
            activeModalTab === 'preview' ? 'bg-black text-white' : 'bg-gray-200 text-black'
          "
          (click)="activeModalTab = 'preview'"
        >
          Preview
        </button>
      </div>

      <!-- METADATA TAB -->
      <div *ngIf="activeModalTab === 'metadata'" class="space-y-5">
        <div>
          <label class="font-medium">Title</label>
          <span class="text-red-500">*</span>
          <input
            type="text"
            [(ngModel)]="courseTitle"
            placeholder="Enter course title"
            class="w-full border placeholder-gray-500 rounded-lg p-2 mt-1 bordercolor focus:outline-none focus:ring-0"
          />
        </div>

        <div>
          <label class="font-medium">Description</label>
          <span class="text-red-500">*</span>
          <textarea
            rows="3"
            [(ngModel)]="courseDesc"
            placeholder="Course description..."
            class="w-full bordercolor placeholder-gray-500 rounded-lg p-2 mt-1 border-1 focus:outline-none focus:ring-0 focus:border-1"
          ></textarea>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="font-medium">Skill</label>
            <span class="text-red-500">*</span>
            <select
              [(ngModel)]="courseSkill"
              class="w-full bordercolor placeholder-gray-500 rounded-lg p-2 mt-1 border-1 focus:outline-none focus:ring-0 focus:border-1"
            >
              <option>Select skill</option>
              <option>Web Development</option>
              <option>UI/UX</option>
              <option>Data Science</option>
            </select>
          </div>

          <div>
            <label class="font-medium">Category</label>
            <span class="text-red-500">*</span>
            <select
              [(ngModel)]="courseCategory"
              class="w-full bordercolor placeholder-gray-500 rounded-lg p-2 mt-1 border-1 focus:outline-none focus:ring-0 focus:border-1"
            >
              <option>Select category</option>
              <option>Technology</option>
              <option>Design</option>
              <option>Business</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="font-medium">Level</label>
            <span class="text-red-500">*</span>
            <select
              [(ngModel)]="courseLevel"
              class="w-full bordercolor placeholder-gray-500 rounded-lg p-2 mt-1 border-1 focus:outline-none focus:ring-0 focus:border-1"
            >
              <option>Beginner</option>
              <option>Intermediate</option>
              <option>Advanced</option>
            </select>
          </div>

          <div>
            <label class="font-medium">Language</label>
            <span class="text-red-500">*</span>
            <select
              [(ngModel)]="courseLanguage"
              class="w-full bordercolor placeholder-gray-500 rounded-lg p-2 mt-1 border-1 focus:outline-none focus:ring-0 focus:border-1"
            >
              <option>English</option>
              <option>Hindi</option>
              <option>Telugu</option>
            </select>
          </div>

          <div>
            <label class="font-medium">Duration</label>
            <span class="text-red-500">*</span>
            <input
              type="text"
              [(ngModel)]="courseDuration"
              placeholder="e.g., 2h 30m"
              class="w-full bordercolor placeholder-gray-500 rounded-lg p-2 mt-1 border-1 focus:outline-none focus:ring-0 focus:border-1"
            />
          </div>
        </div>
      </div>

      <!-- CONTENT TAB -->
      <div *ngIf="activeModalTab === 'content'">
        <p class="font-semibold mb-2">Upload Materials</p>

        <input type="file" #fileInput hidden (change)="handleThumbnail($event)" />

        <div class="border-2 border-dashed border-gray-400 rounded-xl p-10 text-center bg-gray-50">
          <i class="fa fa-upload text-4xl text-gray-600"></i>

          <h3 class="text-lg font-semibold mt-4">Drag files here or browse</h3>

          <p class="text-gray-500 text-sm mt-1">Video, Audio, PDF, DOCX, Markdown supported</p>

          <!-- <button class="mt-4 px-4 py-2 bg-black text-white rounded-md"
            (click)="fileInput.click()">
            Browse Files
          </button> -->

          <input
            type="file"
            (change)="onFileSelected($event)"
            multiple
            accept=".pdf,.png,.jpg,.jpeg,.mp4,.mp3,.doc,.docx"
            class="hidden"
            #filePickerFiles
          />

          <button (click)="filePickerFiles.click()" class="px-4 py-2 bg-black text-white rounded">
            Select Multiple Files
          </button>

          <div class="preview-container">
            <div class="flex justify-end">
              <!-- <i class="fa-solid fa-times text-black text-xl bg-gray-400 rounded-full py-0 px-1 cursor-pointer"></i> -->

              <!-- <i class="fa-solid fa-trash text-red-600"></i> -->

              <button
                *ngIf="selectedFiles.length > 0"
                (click)="removeAllFiles()"
                class="mb-4 p-2 rounded-full text-white"
              >
                <i class="fa-solid fa-trash bg-gray-300 p-1 rounded-full text-blue-600 ttt"></i>
              </button>
            </div>

            <div class="flex flex-wrap gap-4 max-h-60">
              <div *ngFor="let file of selectedFiles; let i = index" class="grid-item">
                <!-- <p>{{ file.name }}</p> -->
                <!-- Image preview -->

                <button (click)="removeFile(i)" class="ml-15 rounded-full hover:bg-gray-200">
                  <i class="fa-solid fa-xmark text-xl"></i>
                </button>
                <img
                  *ngIf="file.type.startsWith('image')"
                  [src]="file.preview"
                  class="h-20 w-20 object-cover rounded p-4 bg-gray-200"
                />
                <!-- Video preview -->
                <video
                  *ngIf="file.type.startsWith('video')"
                  [src]="file.preview"
                  class="h-20 w-20 object-cover rounded p-4 bg-gray-200"
                  muted
                ></video>
                <!-- PDF preview -->
                <iframe
                  *ngIf="file.type === 'application/pdf'"
                  [src]="file.preview"
                  class="h-20 w-20"
                ></iframe>
                <!-- Remove button -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PREVIEW TAB -->
      <div *ngIf="activeModalTab === 'preview'" class="space-y-5">
        <div class="summary p-5 rounded-xl bg-gray-50">
          <p class="text-lg text-[16px] font-bold">Course Preview</p>
          <p class="text-gray-500 text-sm mb-4">How your course will appear</p>

          <div class="bg-gray-100 rounded-lg">
            <h3 class="font-bold text-base">{{ courseTitle || 'Untitled Course' }}</h3>
            <p class="text-gray-600 text-sm">{{ courseDesc || 'No description provided' }}</p>
            <p class="text-gray-700 mt-2 text-sm font-semibold">{{ courseLevel }}</p>
          </div>
        </div>

        <div class="summary p-5 rounded-xl bg-gray-50">
          <h3 class="font-semibold mb-4">Content Summary</h3>

          <div class="flex justify-around text-center">
            <div>
              <p class="text-blue-600 text-2xl font-bold">{{ videoCount }}</p>
              <p class="text-sm text-gray-500">Videos</p>
            </div>
            <div>
              <p class="text-purple-600 text-2xl font-bold">{{ imageCount }}</p>
              <p class="text-sm text-gray-500">Images</p>
            </div>
            <div>
              <p class="text-green-600 text-2xl font-bold">{{ audioCount }}</p>
              <p class="text-sm text-gray-500">Audio Files</p>
            </div>

            <div>
              <p class="text-purple-600 text-2xl font-bold">{{ documentCount }}</p>
              <p class="text-sm text-gray-500">Documents</p>
            </div>
          </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button class="px-4 py-2 bg-gray-300 rounded-md" (click)="closeModal()">Cancel</button>

          <!-- ADDED FUNCTIONALITY -->
          <button
            [disabled]="loading"
            class="px-4 py-2 bg-black text-white rounded-md"
            [ngClass]="
              loading ? 'bg-gray-400 cursor-not-allowed filter' : 'bg-black hover:bg-gray-800'
            "
            (click)="submitForReview()"
          >
            Submit for Review
          </button>
        </div>
      </div>

      <!-- FOOTER BUTTONS -->
    </div>
  </div>
</div>
<!-- toast messages -->
<div
  *ngIf="showToast"
  class="max-w-xs bg-blue-400 text-sm font-semibold text-white text-sm text-teal-800 rounded-lg fixed top-4 right-4 z-50 shadow-lg"
  role="alert"
  tabindex="-1"
  aria-labelledby="hs-toast-soft-color-teal-label"
>
  <div id="hs-toast-solid-color-dark-label" class="flex p-4">
    Course created successfully

    <div class="ms-auto">
      <button
        (click)="showToast = false"
        type="button"
        class="inline-flex bg-white-400 shrink-0 justify-center items-center size-5 rounded-lg text-teal-800 opacity-50 hover:opacity-100 focus:outline-hidden focus:opacity-100"
        aria-label="Close"
      >
        <span class="sr-only">Close</span>
        <svg
          class="shrink-0 size-4"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M18 6 6 18"></path>
          <path d="m6 6 12 12"></path>
        </svg>
      </button>
    </div>
  </div>
</div>
<!-- End Toast -->
